<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI ì§ë¬´ ì¶”ì²œ ì»¨ì„¤í„´íŠ¸</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .input{ @apply w-full border rounded-xl px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500; }
    .btn{ @apply bg-blue-600 text-white rounded-xl px-4 py-2 hover:bg-blue-700; }
    .btn-secondary{ @apply bg-gray-200 text-gray-800 rounded-xl px-4 py-2 hover:bg-gray-300; }
    .json-box{ @apply bg-gray-50 border rounded-xl p-3 min-h-[120px]; }
    .card{ @apply border rounded-2xl p-4; }
    .badge{ @apply inline-block text-xs bg-blue-50 text-blue-700 rounded-full px-2 py-1; }
    .kcol p{ @apply font-medium; }
    .src a{ @apply text-blue-600 hover:underline text-sm; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="max-w-5xl mx-auto px-4 py-6">
    <h1 class="text-2xl font-bold">AI ì§ë¬´ ì¶”ì²œ ì»¨ì„¤í„´íŠ¸</h1>
    <p class="text-sm text-gray-600 mt-1">ì „ê³µÂ·í•™ë…„Â·í•™ì Â·ê´€ì‹¬ì‚¬ ê¸°ë°˜ ë§ì¶¤ ì¶”ì²œ Â·
      <span class="font-semibold">ëª¨ë“  ì¶”ì²œì— ì¶œì²˜ ë§í¬(ìµœì†Œ 2ê°œ) í•„ìˆ˜</span></p>
  </header>

  <main class="max-w-5xl mx-auto px-4 grid md:grid-cols-2 gap-6">
    <!-- ì…ë ¥ -->
    <section class="bg-white rounded-2xl shadow p-5">
      <h2 class="text-lg font-semibold mb-4">ì…ë ¥</h2>
      <form id="form" class="space-y-3">
        <div>
          <label class="block text-sm font-medium mb-1">ëŒ€í•™ëª… (ì„ íƒ)</label>
          <input id="univ" placeholder="ì˜ˆ: OOëŒ€í•™êµ" class="input"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">ì „ê³µ</label>
          <input id="major" required placeholder="ì˜ˆ: ì»´í“¨í„°ê³µí•™ê³¼" class="input"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">í•™ë…„</label>
          <select id="year" class="input">
            <option>1</option><option>2</option><option>3</option><option>4</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">ê´€ì‹¬ ì‚°ì—… (ì„ íƒ, ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
          <input id="industry" placeholder="ì˜ˆ: IT, ê¸ˆìœµ, ì œì¡°" class="input"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">ê´€ì‹¬ì‚¬ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
          <input id="interests" required placeholder="ì˜ˆ: ë°ì´í„° ë¶„ì„, AI, í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ" class="input"/>
        </div>
        <div class="flex items-center gap-3 pt-2">
          <button id="run" class="btn" type="submit">AI ì§ë¬´ ì¶”ì²œ ë°›ê¸°</button>
          <button id="print" class="btn-secondary" type="button">PDF ì €ì¥(ì¸ì‡„)</button>
        </div>
        <p class="text-xs text-gray-500 pt-2">
          ê°œì¸ì •ë³´(ì´ë¦„/í•™ë²ˆ/ì—°ë½ì²˜)ëŠ” ì…ë ¥í•˜ì§€ ë§ˆì„¸ìš”. êµìœ¡ ì‹¤ìŠµìš©ì…ë‹ˆë‹¤.
        </p>
      </form>
    </section>

    <!-- ê²°ê³¼ -->
    <section class="bg-white rounded-2xl shadow p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold">ê²°ê³¼</h2>
        <button id="copyJson" class="text-sm text-blue-600 hover:underline">JSON ë³µì‚¬</button>
      </div>
      <pre id="jsonOut" class="json-box mt-3 whitespace-pre-wrap"></pre>
      <div id="cards" class="mt-5 space-y-4"></div>
    </section>
  </main>

  <footer class="max-w-5xl mx-auto px-4 py-8 text-xs text-gray-500">
    Â© 2025 Career Recommender Â· êµìœ¡ ì‹¤ìŠµìš© Â· ì¶œì²˜ ì—†ëŠ” ì •ë³´ ìƒì„± ê¸ˆì§€
  </footer>

  <script>
    // ===============================================
    // âš ï¸ ì¤‘ìš”: í”„ë¡ì‹œ URLì„ ì„¤ì •í•˜ì„¸ìš”.
    // Netlify/Cloudflare ë“± ì„œë²„ë¦¬ìŠ¤ í”„ë¡ì‹œì˜ ê³µê°œ URLë¡œ êµì²´
    // ì˜ˆ) const PROXY = 'https://<your-netlify-site>.netlify.app/.netlify/functions/recommend';
    // ì˜ˆ) const PROXY = 'https://<your-worker-subdomain>.workers.dev';
    const PROXY = 'YOUR_PROXY_URL_HERE';
    // ===============================================

    // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ì‚¬ì‹¤ ê¸°ë°˜/ì¶œì²˜ ì˜ë¬´)
    const SYSTEM_PROMPT = `ë‹¹ì‹ ì€ í•œêµ­ ëŒ€í•™ìƒì„ ìœ„í•œ ì§ë¬´ ì¶”ì²œ ì „ë¬¸ê°€ AIì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì „ê³µ, í•™ë…„, í•™ì (ì„ íƒ), ê´€ì‹¬ì‚¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§ë¬´ë¥¼ ë¶„ì„í•˜ê³  ì¶”ì²œí•©ë‹ˆë‹¤.

[í•µì‹¬ ì›ì¹™]
1) ì‚¬ì‹¤ ê¸°ë°˜: ê·¼ê±°ê°€ ë¶ˆì¶©ë¶„í•˜ë©´ "ì¶œì²˜ ë¶€ì¡±ìœ¼ë¡œ ì œê³µ ë¶ˆê°€"ë¼ê³  ëª…ì‹œí•©ë‹ˆë‹¤.
2) ê° ì¶”ì²œì—ëŠ” êµ­ë‚´ ê³µì‹ ë ¥ ë°ì´í„°ë² ì´ìŠ¤ ë§í¬ë¥¼ ìµœì†Œ 2ê°œ í¬í•¨í•©ë‹ˆë‹¤.
   - ê³ ìš©24: https://www.work24.go.kr/
   - NCS: https://www.ncs.go.kr/
   - í•œêµ­ì§ì—…ì‚¬ì „: https://www.work.go.kr/consltJobCarpa/srch/jobDic/jobDicSrchByJobCl.do
   - (ë³´ì¡°) O*NET: https://www.onetonline.org/ , WEF: https://www.weforum.org/
3) í—ˆìœ„/ì¶”ì • ì •ë³´, ì—°ë´‰ ì¶”ì •, ê¸°ì—… ë‚´ë¶€ ê·œì • ë“±ì€ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

[ê°€ì¤‘ì¹˜ ê¸°ì¤€]
- ì „ê³µ ì—°ê´€ì„± 45, ê´€ì‹¬ì‚¬ ë§¤ì¹­ 35, í•™ë…„ ì í•©ë„ 10, í•™ìŠµì „ëµ(í•™ì /ë‚œì´ë„) 10 (ì´ 100).

[ì¶œë ¥ ìŠ¤í‚¤ë§ˆ(JSONë§Œ ì¶œë ¥)]
{
  "top_jobs": [
    {
      "job_family": "string",
      "ncs_path": "string",
      "example_roles": ["string","..."],
      "score": 0-100,
      "why_match": ["ì‚¬ìœ  2-4ê°œ"],
      "ksa": {
        "knowledge": ["K 3-6"],
        "skills": ["S 3-6"],
        "attitudes": ["A 3-6"]
      },
      "next_steps": ["3ê°œì›” ê³„íš", "6-12ê°œì›” ê³„íš"],
      "sources": [
        {"title": "ì¶œì²˜ëª…", "url": "ë§í¬"},
        {"title": "ì¶œì²˜ëª…", "url": "ë§í¬"}
      ]
    }
  ],
  "additional_suggestions": ["ë³´ì™„ ìš”ì²­ ë“±"],
  "disclaimer": "í•œê³„/ì£¼ì˜"
}`;

    const form = document.getElementById('form');
    const out = document.getElementById('jsonOut');
    const cards = document.getElementById('cards');

    document.getElementById('print').addEventListener('click', () => window.print());
    document.getElementById('copyJson').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(out.textContent.trim());
        alert('JSONì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (e) { alert('ë³µì‚¬ ì‹¤íŒ¨: ' + e.message); }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      cards.innerHTML = '';
      out.textContent = 'ë¶„ì„ ì¤‘...';

      const payload = {
        university: document.getElementById('univ').value.trim(),
        major: document.getElementById('major').value.trim(),
        year: Number(document.getElementById('year').value.trim() || '0'),
        gpa: null, // í•„ìš”ì‹œ ì…ë ¥ í•„ë“œ ì¶”ê°€í•´ì„œ ì‚¬ìš©
        interests: document.getElementById('interests').value.split(',').map(s => s.trim()).filter(Boolean),
        target_industry_optional: (document.getElementById('industry').value || '').split(',').map(s => s.trim()).filter(Boolean)
      };

      try {
        if (!PROXY || PROXY.includes('YOUR_PROXY_URL_HERE')) {
          throw new Error('í”„ë¡ì‹œ URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½”ë“œ ìƒë‹¨ PROXYë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
        }
        const res = await fetch(PROXY, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ system: SYSTEM_PROMPT, user: payload })
        });
        if (!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + res.status);
        const data = await res.json();

        // ëª¨ë¸ì´ ìˆœìˆ˜ JSONì„ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ê¸°ëŒ€ (í”„ë¡ì‹œì—ì„œ ê°•ì œ)
        out.textContent = JSON.stringify(data, null, 2);
        renderCards(data);
        validate(data);
      } catch (err) {
        out.textContent = 'ì˜¤ë¥˜: ' + err.message +
          '\nì„œë²„ë¦¬ìŠ¤ í”„ë¡ì‹œ(Netlify/Cloudflare)ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
      }
    });

    function renderCards(result){
      if (!result || !Array.isArray(result.top_jobs)) return;
      const frag = document.createDocumentFragment();
      result.top_jobs.forEach(job => {
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <div class="flex items-center justify-between">
            <h3 class="font-semibold text-lg">${esc(job.job_family || 'ì§ë¬´êµ°')}</h3>
            <span class="badge">${job.score ?? '-'}</span>
          </div>
          <p class="text-sm text-gray-600 mt-1">${esc(job.ncs_path || '')}</p>
          <p class="mt-2 text-sm"><strong>ì˜ˆì‹œ ì—­í• :</strong> ${(job.example_roles||[]).map(esc).join(', ')}</p>
          <ul class="list-disc pl-5 mt-2 text-sm">
            ${(job.why_match||[]).map(x=>`<li>${esc(x)}</li>`).join('')}
          </ul>
          <div class="grid md:grid-cols-3 gap-3 mt-3 text-sm kcol">
            <div><p>K</p><ul class="list-disc pl-5">${(job.ksa?.knowledge||[]).map(x=>`<li>${esc(x)}</li>`).join('')}</ul></div>
            <div><p>S</p><ul class="list-disc pl-5">${(job.ksa?.skills||[]).map(x=>`<li>${esc(x)}</li>`).join('')}</ul></div>
            <div><p>A</p><ul class="list-disc pl-5">${(job.ksa?.attitudes||[]).map(x=>`<li>${esc(x)}</li>`).join('')}</ul></div>
          </div>
          <div class="mt-3 text-sm">
            <p class="font-medium">Next steps</p>
            <ul class="list-disc pl-5">${(job.next_steps||[]).map(x=>`<li>${esc(x)}</li>`).join('')}</ul>
          </div>
          <div class="src mt-3">
            ${(job.sources||[]).map(s=>`<a href="${att(s.url||'#')}" target="_blank" rel="noopener">ğŸ”— ${esc(s.title||s.url||'ì¶œì²˜')}</a>`).join('<br/>')}
          </div>`;
        frag.appendChild(el);
      });
      cards.appendChild(frag);
    }

    function validate(result){
      const errs = [];
      if (!result || !Array.isArray(result.top_jobs) || result.top_jobs.length === 0) {
        errs.push('top_jobs í•­ëª©ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        result.top_jobs.forEach((j, i) => {
          const sc = (j.sources||[]).filter(s => s && s.url).length;
          if (sc < 2) errs.push(`ì¶”ì²œ #${i+1}: ì¶œì²˜ê°€ 2ê°œ ë¯¸ë§Œì…ë‹ˆë‹¤.`);
        });
      }
      if (errs.length){
        out.textContent += '\\n\\nâš  ê²€ì¦ ê²½ê³ :\\n- ' + errs.join('\\n- ');
      }
    }

    function esc(s){ return (''+s).replace(/[&<>\"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function att(s){ return esc(s).replace(/"/g, '&quot;'); }
  </script>
</body>
</html>
